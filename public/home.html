<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>La Desesperanza - Inventario</title>
  <link rel="stylesheet" href="/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <header class="d-flex justify-content-between align-items-center p-3 bg-dark text-white">
    <h1 class="m-0">La Desesperanza</h1>
    <div>
      <button id="btn-cerrar-sesion" class="btn btn-outline-light btn-sm">Cerrar sesión</button>
    </div>
  </header>

  <main class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Catálogo de panes</h2>
      <div>
        <button id="btn-agregar" class="btn btn-success">Agregar nuevo pan (Admin)</button>
      </div>
    </div>

    <div id="galeria" class="d-flex flex-wrap gap-3"></div>

    <hr>
    <div id="seccion-carrito" class="mb-4">
      <h3>Carrito</h3>
      <div id="lista-carrito" class="mb-3 border p-3 rounded">
        <p class="text-muted">Carrito vacío</p>
      </div>
      <div id="resumen-carrito">
        <div class="d-flex justify-content-between align-items-center border-top pt-3">
          <p class="h5 mb-0">Total: $<span id="total-carrito">0.00</span></p>
          <div>
            <button id="btn-comprar" class="btn btn-primary" disabled>Realizar compra</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal simple para agregar/editar -->
  <div class="modal" tabindex="-1" id="modal-producto">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="titulo-modal">Nuevo producto</h5>
          <button type="button" class="btn-close" id="cerrar-modal"></button>
        </div>
        <div class="modal-body">
          <form id="formulario-producto">
            <input type="hidden" id="producto-id">
            <div class="mb-2"><label>Nombre</label><input id="producto-nombre" class="form-control" required></div>
            <div class="mb-2"><label>URL imagen</label><input id="producto-imagen" class="form-control" required></div>
            <div class="mb-2"><label>Precio</label><input id="producto-precio" type="number" step="0.01" class="form-control" required></div>
            <div class="mb-2"><label>Cantidad</label><input id="producto-cantidad" type="number" class="form-control" required></div>
            <div class="mb-2"><label>Temporada</label>
              <select id="producto-temporada" class="form-select">
                <option value="normal">Normal</option>
                <option value="navideño">Navideño</option>
              </select>
            </div>
            <button class="btn btn-primary" type="submit">Guardar</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="/auth.js"></script>
  <script src="/main.js"></script>
  <script>
    // Esperar a que el DOM esté listo
    document.addEventListener('DOMContentLoaded', () => {
      // Verificar la autenticación cada segundo durante los primeros 5 segundos
      let intentos = 0;
      const intervalo = setInterval(async () => {
        const usuario = await verificarAutenticacion();
        console.log('Intento de verificación:', intentos + 1, usuario);
        
        if (usuario || intentos >= 5) {
          clearInterval(intervalo);
        }
        intentos++;
      }, 1000);
    });
  </script>
</body>
</html>
